{"version":3,"file":"inline-react.es2017-umd.js","sources":["../src/component.tsx","../src/inline_react.tsx"],"sourcesContent":["import React from \"react\";\n\nexport interface InlineReactProps {\n  children: any;\n  childrenProps: any;\n}\n\nexport interface InlineReactState {\n  childrenProps: any;\n}\n\nexport default class Component extends React.Component<\n  InlineReactProps,\n  InlineReactState\n> {\n  constructor(props: InlineReactProps) {\n    super(props);\n\n    this._componentRef = React.createRef();\n\n    this.state = { childrenProps: props.childrenProps };\n  }\n\n  componentRef(): React.RefObject {\n    // @ts-ignore\n    return this._componentRef;\n  }\n\n  render() {\n    return (\n      <this.props.children\n        ref={this._componentRef}\n        {...this.state.childrenProps}\n      />\n    );\n  }\n}\n","import React from \"react\";\nimport ReactDom from \"react-dom\";\n\nimport Component from \"./component\";\n\nexport interface ComponentsMap {\n  [name: string]: typeof React.Component | React.FunctionComponent;\n}\n\nexport default class InlineReact extends HTMLElement {\n  shadow: ShadowRoot;\n  wrapper: HTMLElement;\n  component!: Component;\n\n  static components: ComponentsMap = {};\n  static observedAttributes = [\"component\", \"props\"];\n\n  static registerComponent(\n    component: typeof React.Component | React.FunctionComponent,\n    name: string = \"\"\n  ): void {\n    this.components[name !== \"\" ? name : component.name] = component;\n  }\n\n  static registerComponents(components: {\n    [key: string]: typeof React.Component | React.FunctionComponent;\n  }) {\n    for (const name in components) {\n      const component = components[name];\n      this.registerComponent(component, name);\n    }\n  }\n\n  constructor() {\n    super();\n\n    this.shadow = this.attachShadow({ mode: \"open\" });\n    this.wrapper = document.createElement(\"div\");\n    this.shadow.appendChild(this.wrapper);\n  }\n\n  disconnectedCallback() {\n    this.unmount();\n  }\n\n  get componentClass(): any {\n    const componentName = this.getAttribute(\"component\");\n    if (typeof componentName !== \"string\") throw Error;\n\n    const component = InlineReact.components[componentName];\n\n    return component;\n  }\n\n  get componentRef(): React.Component {\n    return this.component.componentRef().current;\n  }\n\n  get props(): any {\n    return JSON.parse(this.getAttribute(\"props\") ?? \"{}\");\n  }\n\n  private unmount() {\n    if (!this.component) return;\n\n    ReactDom.unmountComponentAtNode(this.wrapper);\n  }\n\n  private mount() {\n    if (!this.componentClass) return;\n\n    // @ts-ignore\n    this.component = ReactDom.render(\n      <Component children={this.componentClass} childrenProps={this.props} />,\n      this.wrapper\n    );\n  }\n\n  connectedCallback() {\n    this.mount();\n  }\n\n  attributeChangedCallback(name: String, oldValue: String, newValue: String) {\n    switch (name) {\n      case \"component\":\n        if (this.component) this.unmount();\n        if (this.componentClass) this.mount();\n\n        break;\n      case \"props\":\n        if (!this.component) return;\n\n        this.component.setState({\n          childrenProps: this.props,\n        });\n        break;\n    }\n  }\n\n  updateProps(newProps: any) {\n    this.setAttribute(\"props\", JSON.stringify(newProps));\n  }\n}\n\ncustomElements.define(\"inline-react\", InlineReact);\n"],"names":["React","ReactDom"],"mappings":"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"}