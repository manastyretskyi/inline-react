{"version":3,"file":"inline-react.es2017-esm.js","sources":["../src/component.tsx","../src/inline_react.tsx"],"sourcesContent":["import React from \"react\";\n\nexport interface InlineReactProps {\n  children: any;\n  childrenProps: any;\n}\n\nexport interface InlineReactState {\n  childrenProps: any;\n}\n\nexport default class Component extends React.Component<\n  InlineReactProps,\n  InlineReactState\n> {\n  constructor(props: InlineReactProps) {\n    super(props);\n\n    this._componentRef = React.createRef();\n\n    this.state = { childrenProps: props.childrenProps };\n  }\n\n  componentRef(): React.RefObject {\n    // @ts-ignore\n    return this._componentRef;\n  }\n\n  render() {\n    return (\n      <this.props.children\n        ref={this._componentRef}\n        {...this.state.childrenProps}\n      />\n    );\n  }\n}\n","import React from \"react\";\nimport ReactDom from \"react-dom\";\n\nimport Component from \"./component\";\n\nexport interface ComponentsMap {\n  [name: string]: typeof React.Component | React.FunctionComponent;\n}\n\nexport default class InlineReact extends HTMLElement {\n  shadow: ShadowRoot;\n  wrapper: HTMLElement;\n  component!: Component;\n\n  static components: ComponentsMap = {};\n  static observedAttributes = [\"component\", \"props\"];\n\n  static registerComponent(\n    component: typeof React.Component | React.FunctionComponent,\n    name: string = \"\"\n  ): void {\n    this.components[name !== \"\" ? name : component.name] = component;\n  }\n\n  static registerComponents(components: {\n    [key: string]: typeof React.Component | React.FunctionComponent;\n  }) {\n    for (const name in components) {\n      const component = components[name];\n      this.registerComponent(component, name);\n    }\n  }\n\n  constructor() {\n    super();\n\n    this.shadow = this.attachShadow({ mode: \"open\" });\n    this.wrapper = document.createElement(\"div\");\n    this.shadow.appendChild(this.wrapper);\n  }\n\n  disconnectedCallback() {\n    this.unmount();\n  }\n\n  get componentClass(): any {\n    const componentName = this.getAttribute(\"component\");\n    if (typeof componentName !== \"string\") throw Error;\n\n    const component = InlineReact.components[componentName];\n\n    return component;\n  }\n\n  get componentRef(): React.Component {\n    return this.component.componentRef().current;\n  }\n\n  get props(): any {\n    return JSON.parse(this.getAttribute(\"props\") ?? \"{}\");\n  }\n\n  private unmount() {\n    if (!this.component) return;\n\n    ReactDom.unmountComponentAtNode(this.wrapper);\n  }\n\n  private mount() {\n    if (!this.componentClass) return;\n\n    // @ts-ignore\n    this.component = ReactDom.render(\n      <Component children={this.componentClass} childrenProps={this.props} />,\n      this.wrapper\n    );\n  }\n\n  connectedCallback() {\n    this.mount();\n  }\n\n  attributeChangedCallback(name: String, oldValue: String, newValue: String) {\n    switch (name) {\n      case \"component\":\n        if (this.component) this.unmount();\n        if (this.componentClass) this.mount();\n\n        break;\n      case \"props\":\n        if (!this.component) return;\n\n        this.component.setState({\n          childrenProps: this.props,\n        });\n        break;\n    }\n  }\n\n  updateProps(newProps: any) {\n    this.setAttribute(\"props\", JSON.stringify(newProps));\n  }\n}\n\ncustomElements.define(\"inline-react\", InlineReact);\n"],"names":[],"mappings":"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"}